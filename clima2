import time
from functools import reduce

# Generador de datos
def leer_temperaturas():
    ciudades_temperaturas = [
        ("CDMX", 26),
        ("Monterrey", 34),
        ("Toluca", 19),
        ("Cancún", 38),
        # Añadir más datos si es necesario
    ]
    for ciudad, temperatura in ciudades_temperaturas:
        yield (ciudad, temperatura)

# Decorador personalizado
def auditar_funcion(func):
    def wrapper(*args, **kwargs):
        wrapper.contador += 1
        inicio = time.time()
        resultado = func(*args, **kwargs)
        fin = time.time()
        duracion = fin - inicio
        print(f"Función: {func.__name__}")
        print(f"Llamadas: {wrapper.contador}")
        print(f"Duración: {duracion:.4f} segundos")
        return resultado
    wrapper.contador = 0
    return wrapper

# Función principal con decorador
@auditar_funcion
def procesar_temperaturas():
    # Filtrado con filter() y lambda
    temperaturas_filtradas = filter(lambda x: x[1] >= 30, leer_temperaturas())

    # Transformación con map() y lambda
    alertas = map(lambda x: f"Alerta de calor en [{x[0]}]: [{x[1]}]°C", temperaturas_filtradas)

    # Ordenamiento con sorted() y key=lambda
    alertas_ordenadas = sorted(alertas, key=lambda x: int(x.split(':')[1].split(']')[0]), reverse=True)

    # Resumen con reduce()
    temperaturas = [int(x.split(':')[1].split(']')[0]) for x in alertas_ordenadas]
    promedio = reduce(lambda x, y: x + y, temperaturas) / len(temperaturas)

    # Salida final esperada
    print("Lista ordenada de alertas:")
    for alerta in alertas_ordenadas:
        print(alerta)
    print(f"Temperatura promedio de alertas: {promedio:.1f}°C")

    return alertas_ordenadas

# Ejecutar la función principal
procesar_temperaturas()
